"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};function Rests(e,t){const n="undefined"!=typeof window?null===window||void 0===window?void 0:window.fetch:require("node-fetch"),r="undefined"!=typeof window?null===window||void 0===window?void 0:window.FormData:require("form-data");if(!n)throw new Error("Fetch API is not installed. If you are using Node please run `npm install node-fetch`");if(!r)throw new Error("FormData is not installed. If you are using Node please run `npm install form-data`");const i=e=>Object.assign(Object.assign({},e),{headers:Object.assign({},e.headers),params:Object.assign({},e.params),values:Object.assign({},e.values)}),o=e=>{var t,n;if("Object"!=(null===(n=null===(t=null==e?void 0:e.__proto__)||void 0===t?void 0:t.constructor)||void 0===n?void 0:n.name))throw new Error("Invalid $options object.");let r=i(e.$options||{});return delete e.$options,Object.assign(Object.assign({},r),{values:Object.assign(Object.assign({},r.values),e)})},a=(e,t,n=!1)=>{let r=n?e||{}:i(e||{}),o=i(t||{});return o.headers=Object.assign(Object.assign({},r.headers),o.headers),o.params=Object.assign(Object.assign({},r.params),o.params),o.values=Object.assign(Object.assign({},r.values),o.values),Object.assign(r,o),r};e=Object.assign({},e);let s={base:"",headers:{"User-Agent":"Rests JS (v1.0.2)"},params:{},values:{},on_error:void 0,on_success:void 0,on_request:void 0,fetch_agent:null};a(s,(null==e?void 0:e.$options)||{},!0),a(s,t,!0);const u={json:"application/json",form:"multipart/form-data",urlencoded:"application/x-www-form-urlencoded",text:"text/plain"},l=Object.values(u),d=["headers","body","query","path"],c={POST:"body",GET:"query"},f={"multipart/form-data":function(){var e=new r;return e.toString=function(){return this},e},"application/x-www-form-urlencoded":function(){return new URLSearchParams},"application/json":function(){return{append:function(e,t){this.data=this.data||{},this.data[e]=t},toString:function(){return JSON.stringify(this.data)},isEmpty:function(){return!this.data||0==Object.keys(this.data).length}}},"text/plain":function(){return{append:function(e,t){return this.data=this.data||[],this.data.push(t)},toString:function(){return this.data.join("")},isEmpty:function(){return!this.data||0==this.data.length}}}},h=e=>null==e,p=(...e)=>{for(var t=0;t<e.length;t++)if(null!==e[t]&&void 0!==e[t])return e[t];return null},v=(e,t,r,i)=>__awaiter(this,void 0,void 0,(function*(){return n(e,t).then((function(e){var t;return __awaiter(this,void 0,void 0,(function*(){try{var n=e.headers.get("Content-Type")||"";let o={statusCode:e.status,statusText:e.statusText,headers:e.headers,type:e.type,ok:e.ok},a={"application/json":"json","text/plain":"text","(multipart/form-data|application/x-www-form-urlencoded)":"formData",blob:"blob"},s=Object.keys(a).find((e=>new RegExp(e).test(n)))||"blob";if(o[a[s]]=yield e[a[s]](),o.message=(null===(t=null==o?void 0:o.json)||void 0===t?void 0:t.message)||(e.ok?"Success.":"Something went wrong."),!e.ok)throw o;if(r.on_success){let e=r.on_success(o,i);if(void 0!==e)return e}return o}catch(e){if(r.on_error){let t=r.on_error(e,i);if(void 0!==t)return t}return Promise.reject(e)}}))}))}));function m(e,t,n){e.method=(e.method||"get").toUpperCase(),e.params=e.params||{};const r=function(i){var o,w,y,b,g;return __awaiter(this,void 0,void 0,(function*(){if(this instanceof r)throw new Error("This is an endpoint, you can't initialize this.");var _=a(s,t);_.on_request=e.on_request||_.on_request,_.on_success=e.on_success||_.on_success,_.on_error=e.on_error||_.on_error;var j=`${_.base}${e.path}`;((null==i?void 0:i.$sandbox)||(null===(o=null==_?void 0:_.values)||void 0===o?void 0:o.$sandbox))&&(j=`${_.sandboxBase||_.base}${e.path}`);var $,O,x={method:e.method,headers:Object.assign({},_.headers),agent:_.fetch_agent},E=l.includes(e.enctype)?e.enctype:u[e.enctype||"json"],S=Object.assign({},_.params,e.params),T=f[E](),k=new URLSearchParams;for(var q in"FormData"==(null===(w=null==i?void 0:i.constructor)||void 0===w?void 0:w.name)?($=i,i=Object.fromEntries(Array.from($.keys(),(e=>e.endsWith("[]")?[e.slice(0,-2),$.getAll(e)]:[e,$.get(e)])))):i=i||{},S){var N=S[q],P=i[q],R=null===(y=null==_?void 0:_.values)||void 0===y?void 0:y[q],A=N.default,C=(null==i?void 0:i.$sandbox)?N.example:void 0,I=p(P,R,C,A),L=N.name||q,z=N.help||`The '${q}' field is invalid.`;if(N.required&&h(I))throw(D=new Error(z)).field=q,D;if(!h(I)){if("function"==typeof N.format)try{I=N.format(I)}catch(e){throw(D=new Error(e.message||z)).field=q,D}if(N.type&&"any"!==N.type)if((D=new Error(z)).field=q,["string","boolean","number"].includes(N.type)&&typeof I!=N.type||"array"==N.type&&!Array.isArray(I)||"object"==N.type&&(!I||"Object"!==I.__proto__.constructor.name))throw D;if(N.validate)if("RegExp"==(null===(g=null===(b=N.validate)||void 0===b?void 0:b.constructor)||void 0===g?void 0:g.name)&&(N.validate.toJSON=function(){return N.validate.toString().replace(/^\//g,"").replace(/\/$/g,"")}),!new RegExp(N.validate).test(I))throw(D=new Error(z)).field=q,D;if("number"==N.type){var D;if(N.hasOwnProperty("max")&&!isNaN(N.max)&&Number(I)>Number(N.max))throw(D=new Error(`The maximum allowed value allowed for the ${L} parameter is ${N.max}`)).field=q,D;if(N.hasOwnProperty("min")&&!isNaN(N.min)&&Number(I)<Number(N.min))throw(D=new Error(`The minimum allowed value allowed for the ${L} parameter is ${N.min}`)).field=q,D}if(N.in&&Array.isArray(N.in)&&!N.in.includes(I))throw(D=new Error(`The ${L} parameter should be one of these values: ${N.in}`)).field=q,D;var F="string"==typeof N.location?N.location.toLowerCase():c[x.method];if(!F||!d.includes(F))throw new Error(`Invalid location for '${q}' field.`);"headers"!=F?"body"!=F?"query"!=F?"path"==F&&(j=j.replace(new RegExp(`{${(O=L,O.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).trim()}}`),I)):k.append(L,I):T.append(L,I):(x.headers=x.headers||{},x.headers[L]=I)}}var U=k.toString();U&&(j=`${j}?${U}`),T.keys&&(e=>{for(var t of e)return!1;return!0})(T.keys())||T.getLengthSync&&0==T.getLengthSync()||T.isEmpty&&T.isEmpty()||(x.body=T.toString()),x.body&&"multipart/form-data"!==E&&(x.headers=x.headers||{},x.headers["Content-Type"]=E);let J={url:j,options:x,params:i,key:n,instance:s.__$root_instance__,self:m(e,t,n)};if(_.on_request){var B=yield Promise.resolve(_.on_request(J));if(B){if(!(null==B?void 0:B.url)&&!(null==B?void 0:B.options))return B;j=B.url||j,x=B.options||x}if(!1===B)return!1}return v(j,x,_,J)}))};return r}function w(t,n,r,i){var u={[t=t||"Rests"]:function(l){if(!(this instanceof u[t]))throw new Error("This is a category, you can initalize this category to update values using 'new' command.");if(i)throw new Error("This is already initialized, you can use 'set' instead.");let d=a(s,n),c=o(l),f=a(d,c);return Rests(r?(h=e,r.split(".").reduce(((e,t)=>null==e?void 0:e[t]),h)):e,f);var h}};return i&&(u[t].set=function(e){if(this instanceof u[t].set)throw new Error("The set object can't be initialized.");let n=o(e);return a(s,n,!0),u[t]}),u[t]}const y=Object.defineProperty(w("Rests",s,void 0,!0),"__schema__",{value:{schema:e,options:s},writable:!1,enumerable:!1});return s.__$root_instance__=y,function e(t,n,r,i){for(var o in n){var s=n[o];if(!s||"object"!=typeof s)continue;if(void 0!==t[o]){console.warn(`Skipping ${o} as it confilicts with another key in the object`);continue}let l=`${i?i+".":""}${o}`;if(s.hasOwnProperty("path")){var u=s;t[o]=m(u,r,l)}else{if("$"===o.substr(0,1))continue;let n=r;(null==s?void 0:s.$options)&&(n=a(r,null==s?void 0:s.$options)),t[o]=e(w(o,n,l),s,n,l)}}return t}(y,e,{})}let x={$other:{openapi:{fields:"test"},nmi:{test:"ss"}}};