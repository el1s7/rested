"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};const fetchAPI="undefined"!=typeof window?null===window||void 0===window?void 0:window.fetch:require("node-fetch"),formAPI="undefined"!=typeof window?null===window||void 0===window?void 0:window.FormData:require("form-data"),fsAPI="undefined"!=typeof window?void 0:require("fs");if(!fetchAPI)throw new Error("Fetch API is not installed. If you are using Node please run `npm install node-fetch`");if(!formAPI)throw new Error("FormData is not installed. If you are using Node please run `npm install form-data`");function Rests(e,t){const[n,r,o]=[fetchAPI,formAPI,fsAPI];let i=Object.assign({base:"",headers:{},params:{},on_error:void 0,on_success:void 0,on_request:void 0,fetch_agent:null},t);const a={json:"application/json",form:"multipart/form-data",urlencoded:"application/x-www-form-urlencoded",text:"text/plain"},s=Object.values(a),u=["headers","body","query","path"],c={POST:"body",GET:"query"},d={"multipart/form-data":function(){var e=new r;return e.toString=function(){return this},e},"application/x-www-form-urlencoded":function(){return new URLSearchParams},"application/json":function(){return{append:function(e,t){this.data=this.data||{},this.data[e]=t},toString:function(){return JSON.stringify(this.data)},isEmpty:function(){return!this.data||0==Object.keys(this.data).length}}},"text/plain":function(){return{append:function(e,t){return this.data=this.data||[],this.data.push(t)},toString:function(){return this.data.join("")},isEmpty:function(){return!this.data||0==this.data.length}}}},f=e=>null==e,l=(e,t,r)=>n(e,t).then((function(n){var o;return __awaiter(this,void 0,void 0,(function*(){try{var i=n.headers.get("Content-Type")||"";let a={statusCode:n.status,statusText:n.statusText,headers:n.headers,type:n.type,ok:n.ok},s={"application/json":"json","text/plain":"text","(multipart/form-data|application/x-www-form-urlencoded)":"formData"},u=Object.keys(s).find((e=>new RegExp(e).test(i)))||"blob";if(a[s[u]]=yield n[s[u]](),a.message=(null===(o=null==a?void 0:a.json)||void 0===o?void 0:o.message)||(n.ok?"Success.":"Something went wrong."),!n.ok)throw a;if(r.on_success){let n=r.on_success(a,{url:e,options:t});if(void 0!==n)return n}return a}catch(n){if(r.on_error){let o=r.on_error(n,{url:e,options:t});if(void 0!==o)return o}return Promise.reject(n)}}))}));function p(e,t,n){var r={[t=t||"Rests"]:function(o){if(!(this instanceof r[t]))throw new Error("You must initalize this object using 'new' command.");Object.assign(this,e);const i=function(e){if(this instanceof i)throw new Error("This object is already initialized.");if(e.$options){if("string"==typeof e.$options||"function"==typeof e.$options||"number"==typeof e.$options||"boolean"==typeof e.$options)throw new Error("Invalid $options object received.");Object.assign(n,e.$options),delete e.$options}n.values=Object.assign(Object.assign({},n.values),e)}.bind(this);return this.set=i,this.set(o),this}};return r[t]}function h(e,t,n=!1){return e.method=(e.method||"get").toUpperCase(),e.params=e.params||{},function(r){var o;return __awaiter(this,void 0,void 0,(function*(){var p=t||i;p.on_request=e.on_request||p.on_request,p.on_success=e.on_success||p.on_success,p.on_error=e.on_error||p.on_error;var h,w=`${p.base}${e.path}`,y={method:e.method,headers:Object.assign({},p.headers),agent:p.fetch_agent},v=s.includes(e.enctype)?e.enctype:a[e.enctype||"json"],m=Object.assign({},p.params,e.params),g=d[v](),b=new URLSearchParams;if("FormData"==(null===(o=null==r?void 0:r.constructor)||void 0===o?void 0:o.name)){let e={};r.forEach((function(t,n){e[n]=t})),r=e}else r=r||{};for(var _ in m){var j=m[_],E=f(r[_])?j.hasOwnProperty("default")?j.default:p.values&&p.values[_]||(n?j.example:void 0):r[_],$=j.name||_,O=j.help||`The '${_}' field is invalid.`;if(j.required&&f(E))throw(P=new Error(O)).field=_,P;if(!f(E)){if("function"==typeof j.format)try{E=j.format(E)}catch(e){throw(P=new Error(e.message||O)).field=_,P}var P;if(j.type&&"any"!==j.type)if((P=new Error(O)).field=_,["string","boolean","number"].includes(j.type)&&typeof E!=j.type||"array"==j.type&&!Array.isArray(E)||"object"==j.type&&(!E||"Object"!==E.__proto__.constructor.name))throw P;if(j.validate)if(!new RegExp(j.validate).test(E))throw(P=new Error(O)).field=_,P;if(j.in&&Array.isArray(j.in)&&!j.in.includes(E))throw(P=new Error(O)).field=_,P;var x="string"==typeof j.location?j.location.toLowerCase():c[y.method];if(!x||!u.includes(x))throw new Error(`Invalid location for '${_}' field.`);"headers"!=x?"body"!=x?"query"!=x?"path"==x&&(w=w.replace(new RegExp(`:${h=$,h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`),E)):b.append($,E):g.append($,E):(y.headers=y.headers||{},y.headers[$]=E)}}var S=b.toString();if(S&&(w=`${w}?${S}`),g.keys&&(e=>{for(var t of e)return!1;return!0})(g.keys())||g.getLengthSync&&0==g.getLengthSync()||g.isEmpty&&g.isEmpty()||(y.body=g.toString()),y.body&&"multipart/form-data"!==v&&(y.headers=y.headers||{},y.headers["Content-Type"]=v),p.on_request){var q=yield Promise.resolve(p.on_request({url:w,options:y}));if(!1===q)return!1;q&&(null==q?void 0:q.url)&&(w=q.url),q&&(null==q?void 0:q.options)&&(y=q.options)}return l(w,y,p)}))}}return function e(t,n,r,o){for(var i in n){var a=n[i];if(a&&"object"==typeof a)if(a.hasOwnProperty("path")){var s=a;if(t._ne=!0,void 0!==t[i]){console.warn(`Skipping ${i} as it confilicts with another key in the object, avoid using keys like ('set') because they are reserved constructor words.`);continue}t[i]=h(s,o)}else{var u=a;if("$options"===i){var c=u;o=Object.assign({},o,c)}if("$"===i.substr(0,1))continue;t[i]=e({},u,i,o)}}return t=t._ne?Object.assign(t,{set:p(t,r,o)}):t}(Object.defineProperty({},"__schema__",{value:{schema:e,options:i},writable:!1,enumerable:!1}),e,"Rests",i)}