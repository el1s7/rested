/*
* Wrape v1.1.3
* Author: Elis <contact@elis.cc>
* License: MIT
*/
function Wrape(e,t){e=e||{};function n(e,t){var n={[t=t||"Wrape"]:function(r){if(!(this instanceof n[t]))throw new Error("You must initalize this object using 'new' command.");Object.assign(this,e),this.def_values=r;var a=function(e){if(this instanceof a)throw new Error("You can't initalize this object.");this.def_values=e}.bind(this);return this.set=a,this}};return n[t]}function r(e){return null==e}function a(e){e.method="string"==typeof e.method?e.method.toUpperCase():"GET";var n=["headers","body","query","path"],a=["multipart/form-data","application/x-www-form-urlencoded","application/json"];e.enctype=e.enctype&&a.includes(e.enctype)?e.enctype:a[0];var o={POST:"body",GET:"query"};return async function(i){var s=`${t.base}${e.path}`,u={method:e.method,headers:t.headers,agent:t.agent},f=Object.keys(e.params),c=Array.from(arguments);c.length>1?i=c.reduce(function(e,t,n){return f[n]?(e[f[n]]=t,e):e},{}):c[0]instanceof FormData?(i={},c[0].forEach(function(e,t){i[t]=e})):i=1!=c.length||1!=f.length||!c[0]||c[0][f[0]]||c[0]instanceof FormData?i||{}:{[f[0]]:c[0]},this.def_values=this.def_values||{};var d,h={"multipart/form-data":function(){return new URLSearchParams},"application/x-www-form-urlencoded":function(){return new FormData},"application/json":function(){return{append:function(e,t){return this[e]=t},toString:function(){return JSON.stringify(this)}}}}[e.enctype](),p=new URLSearchParams;for(var l in e.params){var y=e.params[l],m=i[l]||this.def_values[l]||t.params[l]||y.default,w=y.name||l;if(y.required&&r(m))throw new Error(y.help||`The '${l}' field is required.`);if(!r(m)){if("function"==typeof y.formatter&&(m=y.formatter(m)),y.validate&&!new RegExp(y.validate).test(m))throw new Error(y.help||`The '${l}' field is invalid.`);var v="string"==typeof y.location?y.location.toLowerCase():o[u.method];if(!v||!n.includes(v))throw new Error(`Invalid location for '${l}' field.`);"headers"!=v?"body"!=v?"query"!=v?"path"==v&&(s=s.replace(new RegExp(`:${d=l,d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`),m)):p.append(w,m):h.append(w,m):(u.headers=u.headers||{},u.headers[w]=m)}}var g=p.toString();return g&&(s=`${s}?${g}`),(h.keys&&!function(e){for(var t of e)return!1;return!0}(h.keys())||h.toString().length>1)&&(u.body=e.enctype==a[0]?h:h.toString()),u.body&&e.enctype!==a[0]&&(u.headers=u.headers||{},u.headers["Content-Type"]=e.enctype),function(e,t,n){return fetch(e,t).then(async function(e){if(!e.ok)return Promise.reject(e);var t=e.headers.get("Content-Type"),n={status_code:e.status,status:e.status,statusText:e.statusText,headers:e.headers};return t&&new RegExp("application/json").test(t)?n.json=await e.json():t&&new RegExp("text/").test(t)?n.text=await e.text():n.arrayBuffer=await e.arrayBuffer(),n})}(s,u)}}return t=Object.assign({base:"",headers:{},params:{},agent:!1},t),function e(t,r,o){for(var i in r){var s=r[i];if(s.hasOwnProperty("path")){var u=s;if(t._ne=!0,void 0!==t[i]){console.warn(`Skipping ${i} as it confilicts with another key in the object, avoid using keys like ('set') because they are reserved constructor words.`);continue}t[i]=a(u)}else t[i]=e({},s,i)}return t=t._ne?Object.assign(t,{set:n(t,o)}):t}({},e,!0)}!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Wrape=t()}("undefined"!=typeof self?self:this,function(){return Wrape});