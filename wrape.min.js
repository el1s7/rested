/*
* Wrape v1.1.0
* Author: Elis <contact@elis.cc>
* License: MIT
*/
function Wrape(e,t){e=e||{};function r(e,t){var r={[t=t||"Wrape"]:function(n){if(!(this instanceof r[t]))throw new Error("You must initalize this object using 'new' command.");this.def_values=n,Object.assign(this,e);var a=function(e){if(this instanceof a)throw new Error("You can't initalize this object.");this.def_values=e}.bind(this);return this.set=a,this}};return r[t]}function n(e){return null==e}function a(e){e.method="string"==typeof e.method?e.method.toUpperCase():"GET";var r=["headers","body","query","path"],a=["multipart/form-data","application/x-www-form-urlencoded","application/json"];e.enctype=e.enctype&&a.includes(e.enctype)?e.enctype:a[0];var s={POST:"body",GET:"query"};return async function(i){var o=`${t.base}${e.path}`,u={method:e.method,headers:t.headers,agent:t.agent};request_params=Object.keys(e.params),argument_params=Array.from(arguments),i=argument_params.length>1?argument_params.reduce(function(e,t,r){return request_params[r]?(e[request_params[r]]=t,e):e},{}):1==argument_params.length&&1==request_params.length&&"object"!=typeof argument_params[0]?{[request_params[0]]:argument_params[0]}:i||{},this.def_values=this.def_values||{};var p,f={"multipart/form-data":function(){return new URLSearchParams},"application/x-www-form-urlencoded":function(){return new FormData},"application/json":function(){return{append:function(e,t){return this[e]=t},toString:function(){return JSON.stringify(this)}}}}[e.enctype](),c=new URLSearchParams;for(var d in e.params){var h=e.params[d],m=i[d]||this.def_values[d]||t.params[d]||h.default,l=h.name||d;if(h.required&&n(m))throw new Error(h.help||`The '${d}' field is required.`);if(!n(m)){if("function"==typeof h.formatter&&(m=h.formatter(m)),h.validate&&!new RegExp(h.validate).test(m))throw new Error(h.help||`The '${d}' field is invalid.`);var y="string"==typeof h.location?h.location.toLowerCase():s[u.method];if(!y||!r.includes(y))throw new Error(`Invalid location for '${d}' field.`);"headers"!=y?"body"!=y?"query"!=y?"path"==y&&(o=o.replace(new RegExp(`:${p=d,p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`),m)):c.append(l,m):f.append(l,m):(u.headers=u.headers||{},u.headers[l]=m)}}return(c=c.toString())&&(o=`${o}?${c}`),(f.keys&&!function(e){for(var t of e)return!1;return!0}(f.keys())||f.toString().length>1)&&(u.body=e.enctype==a[0]?f:f.toString()),u.body&&e.enctype!==a[0]&&(u.headers=u.headers||{},u.headers["Content-Type"]=e.enctype),function(e,t,r){return fetch(e,t).then(async function(e){if(!e.ok)return Promise.reject(e);var t=e.headers.get("Content-Type"),r={status_code:e.status,status:e.status,statusText:e.statusText,headers:e.headers};return t&&new RegExp("application/json").test(t)?r.json=await e.json():t&&new RegExp("text/").test(t)?r.text=await e.text():r.arrayBuffer=await e.arrayBuffer(),r})}(o,u)}}return t=Object.assign({base:"",headers:{},params:{},agent:!1},t),function e(t,n,s){for(var i in n){var o=n[i];if(o.hasOwnProperty("path")){var u=o;if(t._ne=!0,void 0!==t[i]){console.warn(`Skipping ${i} as it confilicts with another key in the object, avoid using keys like ('set') because they are reserved constructor words.`);continue}t[i]=a(u)}else t[i]=e({},o,i)}return t=t._ne?Object.assign(t,{set:r(t,s)}):t}({},e,!0)}!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Wrape=t()}("undefined"!=typeof self?self:this,function(){return Wrape});