/*
* Wrape v1.1.2
* Author: Elis <contact@elis.cc>
* License: MIT
*/
function Wrape(e,t){e=e||{};function n(e,t){var n={[t=t||"Wrape"]:function(r){if(!(this instanceof n[t]))throw new Error("You must initalize this object using 'new' command.");this.def_values=r,Object.assign(this,e);var a=function(e){if(this instanceof a)throw new Error("You can't initalize this object.");this.def_values=e}.bind(this);return this.set=a,this}};return n[t]}function r(e){return null==e}function a(e){e.method="string"==typeof e.method?e.method.toUpperCase():"GET";var n=["headers","body","query","path"],a=["multipart/form-data","application/x-www-form-urlencoded","application/json"];e.enctype=e.enctype&&a.includes(e.enctype)?e.enctype:a[0];var i={POST:"body",GET:"query"};return async function(o){var s=`${t.base}${e.path}`,u={method:e.method,headers:t.headers,agent:t.agent},f=Object.keys(e.params),c=Array.from(arguments);o=c.length>1?c.reduce(function(e,t,n){return f[n]?(e[f[n]]=t,e):e},{}):1==c.length&&1==f.length&&"object"!=typeof c[0]?{[f[0]]:c[0]}:o||{},this.def_values=this.def_values||{};var d,p={"multipart/form-data":function(){return new URLSearchParams},"application/x-www-form-urlencoded":function(){return new FormData},"application/json":function(){return{append:function(e,t){return this[e]=t},toString:function(){return JSON.stringify(this)}}}}[e.enctype](),h=new URLSearchParams;for(var l in e.params){var y=e.params[l],m=o[l]||this.def_values[l]||t.params[l]||y.default,w=y.name||l;if(y.required&&r(m))throw new Error(y.help||`The '${l}' field is required.`);if(!r(m)){if("function"==typeof y.formatter&&(m=y.formatter(m)),y.validate&&!new RegExp(y.validate).test(m))throw new Error(y.help||`The '${l}' field is invalid.`);var g="string"==typeof y.location?y.location.toLowerCase():i[u.method];if(!g||!n.includes(g))throw new Error(`Invalid location for '${l}' field.`);"headers"!=g?"body"!=g?"query"!=g?"path"==g&&(s=s.replace(new RegExp(`:${d=l,d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`),m)):h.append(w,m):p.append(w,m):(u.headers=u.headers||{},u.headers[w]=m)}}return(h=h.toString())&&(s=`${s}?${h}`),(p.keys&&!function(e){for(var t of e)return!1;return!0}(p.keys())||p.toString().length>1)&&(u.body=e.enctype==a[0]?p:p.toString()),u.body&&e.enctype!==a[0]&&(u.headers=u.headers||{},u.headers["Content-Type"]=e.enctype),function(e,t,n){return fetch(e,t).then(async function(e){if(!e.ok)return Promise.reject(e);var t=e.headers.get("Content-Type"),n={status_code:e.status,status:e.status,statusText:e.statusText,headers:e.headers};return t&&new RegExp("application/json").test(t)?n.json=await e.json():t&&new RegExp("text/").test(t)?n.text=await e.text():n.arrayBuffer=await e.arrayBuffer(),n})}(s,u)}}return t=Object.assign({base:"",headers:{},params:{},agent:!1},t),function e(t,r,i){for(var o in r){var s=r[o];if(s.hasOwnProperty("path")){var u=s;if(t._ne=!0,void 0!==t[o]){console.warn(`Skipping ${o} as it confilicts with another key in the object, avoid using keys like ('set') because they are reserved constructor words.`);continue}t[o]=a(u)}else t[o]=e({},s,o)}return t=t._ne?Object.assign(t,{set:n(t,i)}):t}({},e,!0)}!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.Wrape=t()}("undefined"!=typeof self?self:this,function(){return Wrape});